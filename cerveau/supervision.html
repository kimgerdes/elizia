<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="Generator" content="Kate, the KDE Advanced Text Editor" />
<title>supervision.cgi</title>
</head>
<body>
<pre>
<span style="font-style: italic;color: #808080;">#!/usr/bin/python</span>
<span style="font-style: italic;color: #808080;"># -*- coding: iso-8859-1 -*-</span>

<span style="font-style: italic;color: #808080;">####</span>
<span style="font-style: italic;color: #808080;"># Copyright (C) 2006, 2007 Kim Gerdes</span>
<span style="font-style: italic;color: #808080;"># kim AT gerdes.fr</span>
<span style="font-style: italic;color: #808080;">#</span>
<span style="font-style: italic;color: #808080;"># This program is free software; you can redistribute it and/or</span>
<span style="color: #000000;"> </span><span style="font-style: italic;color: #808080;"># modify it under the terms of the GNU General Public License</span>
<span style="color: #000000;"> </span><span style="font-style: italic;color: #808080;"># as published by the Free Software Foundation; either version 2</span>
<span style="color: #000000;"> </span><span style="font-style: italic;color: #808080;"># of the License, or (at your option) any later version.</span>
<span style="font-style: italic;color: #808080;">#</span>
<span style="font-style: italic;color: #808080;"># This script is distributed in the hope that it will be useful,</span>
<span style="font-style: italic;color: #808080;"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span style="font-style: italic;color: #808080;"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE</span>
<span style="font-style: italic;color: #808080;"># See the GNU General Public License (www.gnu.org) for more details.</span>
<span style="font-style: italic;color: #808080;">#</span>
<span style="font-style: italic;color: #808080;"># You can retrieve a copy of the GNU General Public License</span>
<span style="font-style: italic;color: #808080;"># from http://www.gnu.org/.  For a copy via US Mail, write to the</span>
<span style="font-style: italic;color: #808080;">#     Free Software Foundation, Inc.</span>
<span style="font-style: italic;color: #808080;">#     59 Temple Place - Suite 330,</span>
<span style="font-style: italic;color: #808080;">#     Boston, MA  02111-1307</span>
<span style="font-style: italic;color: #808080;">#     USA</span>
<span style="font-style: italic;color: #808080;">####</span>

<span style="color: #ff00ff;">import</span><span style="color: #000000;"> time, re, cgitb, cgi, sha, Cookie, os, sys</span>
<span style="color: #ff00ff;">import</span><span style="color: #000000;"> session</span>
<span style="color: #ff00ff;">from</span><span style="color: #000000;"> random </span><span style="color: #ff00ff;">import</span><span style="color: #000000;"> choice</span>
<span style="color: #ff00ff;">from</span><span style="color: #000000;"> frenchLinguist </span><span style="color: #ff00ff;">import</span><span style="color: #000000;"> FrenchLinguist</span>
<span style="color: #ff00ff;">from</span><span style="color: #000000;"> rogers </span><span style="color: #ff00ff;">import</span><span style="color: #000000;"> Rogers</span>
<span style="color: #ff00ff;">from</span><span style="color: #000000;"> analyste </span><span style="color: #ff00ff;">import</span><span style="color: #000000;"> Elizia</span>

<span style="color: #000000;">cgitb.enable</span><span style="color: #ff00ff;">()</span>

<span style="font-style: italic;color: #808080;"># Some hosts will need to have document_root appended</span>
<span style="font-style: italic;color: #808080;"># to sys.path to be able to find user modules</span>
<span style="font-style: italic;color: #808080;">#sys.path.append(os.environ['DOCUMENT_ROOT'])</span>

<span style="color: #000000;">machine </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"elizia.net"</span>
<span style="color: #000000;">cefichier </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"supervision.cgi"</span>
<span style="color: #000000;">stylesheet </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"/eliziastyle.css"</span><span style="color: #000000;"> </span><span style="font-style: italic;color: #808080;"># avec chemin depuis machine</span>


<span style="color: #000000;">sess </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> session.Session</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">expires</span><span style="color: #ff00ff;">=</span><span style="color: #0000ff;">365</span><span style="color: #ff00ff;">*</span><span style="color: #0000ff;">24</span><span style="color: #ff00ff;">*</span><span style="color: #0000ff;">60</span><span style="color: #ff00ff;">*</span><span style="color: #0000ff;">60</span><span style="color: #000000;">, cookie_path</span><span style="color: #ff00ff;">=</span><span style="color: #dd0000;">'/'</span><span style="color: #ff00ff;">)</span>
<span style="font-style: italic;color: #808080;"># expires can be reset at any moment:</span>
<span style="font-style: italic;color: #808080;">#sess.set_expires('')</span>
<span style="font-style: italic;color: #808080;"># or changed:</span>
<span style="font-style: italic;color: #808080;">#sess.set_expires(30*24*60*60)</span>
<span style="font-style: italic;color: #808080;"># Session data is a dictionary like object</span>


<span style="font-weight: bold;color: #000000;">def</span><span style="color: #000000;"> connaissance</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">total_seconds</span><span style="color: #ff00ff;">):</span>

<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> total_seconds </span><span style="color: #ff00ff;">&lt;</span><span style="color: #0000ff;">1</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span>
<span style="color: #000000;">		</span><span style="font-weight: bold;color: #000000;">return</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"On est en train de faire connaissance"</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">else</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span>
<span style="color: #000000;">		seconds </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> total_seconds </span><span style="color: #ff00ff;">%</span><span style="color: #000000;"> </span><span style="color: #0000ff;">60</span>
<span style="color: #000000;">		total_minutes </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> total_seconds </span><span style="color: #ff00ff;">/</span><span style="color: #000000;"> </span><span style="color: #0000ff;">60</span>
<span style="color: #000000;">		minutes </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> total_minutes </span><span style="color: #ff00ff;">%</span><span style="color: #000000;"> </span><span style="color: #0000ff;">60</span>
<span style="color: #000000;">		total_hours </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> total_minutes </span><span style="color: #ff00ff;">/</span><span style="color: #000000;"> </span><span style="color: #0000ff;">60</span>
<span style="color: #000000;">		hours </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> total_hours </span><span style="color: #ff00ff;">%</span><span style="color: #000000;"> </span><span style="color: #0000ff;">24</span>
<span style="color: #000000;">		total_days </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> total_hours </span><span style="color: #ff00ff;">/</span><span style="color: #000000;"> </span><span style="color: #0000ff;">24</span>
<span style="color: #000000;">		days </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> total_days </span><span style="color: #ff00ff;">%</span><span style="color: #000000;"> </span><span style="color: #0000ff;">365</span>
<span style="color: #000000;">		years </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> total_days </span><span style="color: #ff00ff;">/</span><span style="color: #000000;"> </span><span style="color: #0000ff;">365</span>
<span style="color: #000000;">		text </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"On se connait depuis plus de "</span>
<span style="color: #000000;">		per </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">[</span><span style="color: #000000;">years, days, hours, minutes, seconds</span><span style="color: #ff00ff;">]</span>
<span style="color: #000000;">		pernom </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">[</span><span style="color: #dd0000;">'année'</span><span style="color: #000000;">, </span><span style="color: #dd0000;">'mois'</span><span style="color: #000000;">, </span><span style="color: #dd0000;">'heure'</span><span style="color: #000000;">, </span><span style="color: #dd0000;">'minute'</span><span style="color: #000000;">, </span><span style="color: #dd0000;">'seconde'</span><span style="color: #ff00ff;">]</span>
<span style="color: #000000;">		</span><span style="font-weight: bold;color: #000000;">for</span><span style="color: #000000;"> i </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> </span><span style="color: #800000;">range</span><span style="color: #ff00ff;">(</span><span style="color: #800000;">len</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">per</span><span style="color: #ff00ff;">)):</span>
<span style="color: #000000;">			</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> per</span><span style="color: #ff00ff;">[</span><span style="color: #000000;">i</span><span style="color: #ff00ff;">]</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span><span style="color: #000000;">  </span>
<span style="color: #000000;">				text</span><span style="color: #ff00ff;">+=</span><span style="color: #000000;"> </span><span style="color: #800000;">str</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">per</span><span style="color: #ff00ff;">[</span><span style="color: #000000;">i</span><span style="color: #ff00ff;">])</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">+</span><span style="color: #000000;"> </span><span style="color: #dd0000;">" "</span><span style="color: #ff00ff;">+</span><span style="color: #000000;">pernom</span><span style="color: #ff00ff;">[</span><span style="color: #000000;">i</span><span style="color: #ff00ff;">]</span>
<span style="color: #000000;">				</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> per</span><span style="color: #ff00ff;">[</span><span style="color: #000000;">i</span><span style="color: #ff00ff;">]&gt;</span><span style="color: #0000ff;">1</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> text</span><span style="color: #ff00ff;">+=</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"s"</span>
<span style="color: #000000;">				</span><span style="font-weight: bold;color: #000000;">break</span>
<span style="color: #000000;">		</span><span style="font-weight: bold;color: #000000;">return</span><span style="color: #000000;"> text</span>
<span style="color: #000000;">	</span>





<span style="color: #000000;">e </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> Elizia</span><span style="color: #ff00ff;">()</span>

<span style="color: #000000;">DBmessage </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> e.linguist.dataBaseStatus</span>

<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> sess.cookie</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"Content-Type: text/html\n"</span><span style="color: #000000;"> </span><span style="font-style: italic;color: #808080;"># blank line : end of headers</span>


<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"""&lt;html&gt;</span>
<span style="color: #dd0000;">	&lt;head&gt;&lt;title&gt;Supervision Elizia &lt;/title&gt;</span>
<span style="color: #dd0000;">	&lt;META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1"&gt;"""</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"""&lt;style type="text/css"&gt;</span>
<span style="color: #dd0000;">	td { border:thin solid #ddd; }</span>
<span style="color: #dd0000;">	&lt;/style&gt;"""</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;">	</span><span style="color: #dd0000;">'&lt;link href="http://'</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">+</span><span style="color: #000000;"> machine </span><span style="color: #ff00ff;">+</span><span style="color: #000000;">stylesheet</span><span style="color: #ff00ff;">+</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'" rel="stylesheet" type="text/css"&gt;&lt;/head&gt;'</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;body OnLoad='document.entree.probleme.focus();'&gt; &lt;h1&gt; Supervision d'&lt;a href='http://elizia.net'&gt;Elizia&lt;/a&gt;&lt;/h1&gt;"</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;p&gt;Ici, on peut changer les réponses d'&lt;a href='http://elizia.net'&gt;Elizia&lt;/a&gt; :&lt;/p&gt;&lt;p&gt;Les déclencheurs des cas spéciaux sont codés en dur, donc non-modifiable ici. Le cas 'Reprise' remplace 'xxx' avec le nom d'un cas reconnu avant dans la conversation. Le nom d'une section est donc important. Les réponses sont choisies dans un ordre arbitraire, en essayant d'éviter des répétitions directe. Dans le cas 'Insulte', les réponses sont données dans l'ordre et &lt;a href='http://elizia.net'&gt;Elizia&lt;/a&gt; prend congé quand elle n'a plus de réponse.&lt;/p&gt;"</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;p&gt;Dans la section 'cas normaux' vous pouvez changer les mots clés déclencheurs ainsi que les réponses.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;"</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;p&gt;Tout en bas, vous pouvez créer un nouveau cas avec des mots clés et des réponses de votre choix.&lt;/p&gt;"</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;p&gt;N'oubliez pas de cliquer sur 'Mettre à jour' quand vous avez changé quelque chose.&lt;/p&gt;"</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;p&gt;Dans le champ d'Eliza ci-dessous, vous pouvez tester si tout marche comme vous le souhaitez. Les changements ne s'appliquent que pour vous (vous avez un cookie grâce auquel &lt;a href='http://elizia.net'&gt;Elizia&lt;/a&gt; vous reconnaît) mais ils sont enrégistrés et si vos idées sont bonnes, on s'en inspirera...	&lt;/p&gt;&lt;br&gt;&lt;br&gt;"</span>


<span style="font-style: italic;color: #808080;"># get already saved special cases</span>
<span style="color: #000000;">specialKeys </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> sess.data.get</span><span style="color: #ff00ff;">(</span><span style="color: #dd0000;">'specialKeys'</span><span style="color: #ff00ff;">)</span>
<span style="color: #000000;">specialAnswers </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> sess.data.get</span><span style="color: #ff00ff;">(</span><span style="color: #dd0000;">'specialAnswers'</span><span style="color: #ff00ff;">)</span>

<span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> specialKeys </span><span style="color: #ff00ff;">:</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">for</span><span style="color: #000000;"> c </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> specialKeys.keys</span><span style="color: #ff00ff;">():</span>
<span style="color: #000000;">		e.rogers.keywords</span><span style="color: #ff00ff;">[</span><span style="color: #000000;">c</span><span style="color: #ff00ff;">]=</span><span style="color: #000000;"> specialKeys</span><span style="color: #ff00ff;">[</span><span style="color: #000000;">c</span><span style="color: #ff00ff;">]</span>
<span style="font-weight: bold;color: #000000;">else</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span><span style="color: #000000;">  specialKeys</span><span style="color: #ff00ff;">={}</span>

<span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> specialAnswers </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> </span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">for</span><span style="color: #000000;"> c </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> specialAnswers.keys</span><span style="color: #ff00ff;">():</span>
<span style="color: #000000;">		e.rogers.answers</span><span style="color: #ff00ff;">[</span><span style="color: #000000;">c</span><span style="color: #ff00ff;">]=</span><span style="color: #000000;"> specialAnswers</span><span style="color: #ff00ff;">[</span><span style="color: #000000;">c</span><span style="color: #ff00ff;">]</span>
<span style="font-weight: bold;color: #000000;">else</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span><span style="color: #000000;">	specialAnswers</span><span style="color: #ff00ff;">={}</span>


<span style="color: #000000;">form </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> cgi.FieldStorage</span><span style="color: #ff00ff;">()</span>
<span style="color: #000000;">probleme </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #dd0000;">""</span>

<span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> form.has_key</span><span style="color: #ff00ff;">(</span><span style="color: #dd0000;">"cas"</span><span style="color: #ff00ff;">)</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span>
<span style="color: #000000;">	keys </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #008000;">None</span>
<span style="color: #000000;">	cas </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> form</span><span style="color: #ff00ff;">[</span><span style="color: #dd0000;">"cas"</span><span style="color: #ff00ff;">]</span><span style="color: #000000;">.value</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> form.has_key</span><span style="color: #ff00ff;">(</span><span style="color: #dd0000;">"probleme"</span><span style="color: #ff00ff;">)</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> probleme </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> form</span><span style="color: #ff00ff;">[</span><span style="color: #dd0000;">"probleme"</span><span style="color: #ff00ff;">]</span><span style="color: #000000;">.value</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> form.has_key</span><span style="color: #ff00ff;">(</span><span style="color: #dd0000;">"keys"</span><span style="color: #ff00ff;">)</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> keys </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">[</span><span style="color: #000000;">k.strip</span><span style="color: #ff00ff;">()</span><span style="color: #000000;"> </span><span style="font-weight: bold;color: #000000;">for</span><span style="color: #000000;"> k </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> form</span><span style="color: #ff00ff;">[</span><span style="color: #dd0000;">"keys"</span><span style="color: #ff00ff;">]</span><span style="color: #000000;">.value.split</span><span style="color: #ff00ff;">(</span><span style="color: #dd0000;">"\n"</span><span style="color: #ff00ff;">)</span><span style="color: #000000;"> </span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> k.strip</span><span style="color: #ff00ff;">()]</span>
<span style="color: #000000;">	answers </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">[</span><span style="color: #000000;">a.strip</span><span style="color: #ff00ff;">()</span><span style="color: #000000;"> </span><span style="font-weight: bold;color: #000000;">for</span><span style="color: #000000;"> a </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> form</span><span style="color: #ff00ff;">[</span><span style="color: #dd0000;">"answers"</span><span style="color: #ff00ff;">]</span><span style="color: #000000;">.value.split</span><span style="color: #ff00ff;">(</span><span style="color: #dd0000;">"\n"</span><span style="color: #ff00ff;">)</span><span style="color: #000000;"> </span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> a.strip</span><span style="color: #ff00ff;">()]</span>
<span style="color: #000000;">	</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> keys </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> e.rogers.keywords</span><span style="color: #ff00ff;">[</span><span style="color: #000000;">cas</span><span style="color: #ff00ff;">]=</span><span style="color: #000000;"> keys</span>
<span style="color: #000000;">	e.rogers.answers</span><span style="color: #ff00ff;">[</span><span style="color: #000000;">cas</span><span style="color: #ff00ff;">]=</span><span style="color: #000000;">answers</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> keys </span><span style="color: #ff00ff;">:</span><span style="color: #000000;">specialKeys</span><span style="color: #ff00ff;">[</span><span style="color: #000000;">cas</span><span style="color: #ff00ff;">]=</span><span style="color: #000000;"> keys</span>
<span style="color: #000000;">	specialAnswers</span><span style="color: #ff00ff;">[</span><span style="color: #000000;">cas</span><span style="color: #ff00ff;">]=</span><span style="color: #000000;">answers</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> specialKeys </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> sess.data</span><span style="color: #ff00ff;">[</span><span style="color: #dd0000;">'specialKeys'</span><span style="color: #ff00ff;">]</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> specialKeys</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> specialAnswers </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> sess.data</span><span style="color: #ff00ff;">[</span><span style="color: #dd0000;">'specialAnswers'</span><span style="color: #ff00ff;">]</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> specialAnswers</span>



<span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> </span><span style="font-weight: bold;color: #000000;">not</span><span style="color: #000000;"> form.has_key</span><span style="color: #ff00ff;">(</span><span style="color: #dd0000;">"probleme"</span><span style="color: #ff00ff;">)</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> os.environ.get</span><span style="color: #ff00ff;">(</span><span style="color: #dd0000;">"HTTP_REFERER"</span><span style="color: #000000;">, </span><span style="color: #dd0000;">"&lt;not present&gt;"</span><span style="color: #ff00ff;">)</span><span style="color: #000000;">.endswith</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">cefichier</span><span style="color: #ff00ff;">)</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span>
<span style="color: #000000;">		</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;p class = 'vous'&gt;Vous :"</span><span style="color: #000000;">,probleme,</span><span style="color: #dd0000;">"&lt;/p&gt;"</span>
<span style="color: #000000;">		</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;p class = 'elizia'&gt;Elizia :"</span><span style="color: #000000;">,e.analyse</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">probleme,sess</span><span style="color: #ff00ff;">)</span><span style="color: #000000;">,</span><span style="color: #dd0000;">"&lt;/p&gt;"</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">else</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> </span>
<span style="color: #000000;">		</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;p class = 'elizia'&gt;Elizia : Mettez-vous à l'aise et parlez-moi ouvertement de vos problèmes !&lt;/p&gt;"</span>
<span style="font-weight: bold;color: #000000;">else</span><span style="color: #000000;">  </span><span style="color: #ff00ff;">:</span>
<span style="color: #000000;">	probleme </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> form</span><span style="color: #ff00ff;">[</span><span style="color: #dd0000;">"probleme"</span><span style="color: #ff00ff;">]</span><span style="color: #000000;">.value</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;p class = 'vous'&gt;Vous :"</span><span style="color: #000000;">,probleme,</span><span style="color: #dd0000;">"&lt;/p&gt;"</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;p class = 'elizia'&gt;Elizia :"</span><span style="color: #000000;">,e.analyse</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">probleme,sess</span><span style="color: #ff00ff;">)</span><span style="color: #000000;">,</span><span style="color: #dd0000;">"&lt;/p&gt;"</span>
<span style="color: #000000;">	</span>

<span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> </span><span style="font-weight: bold;color: #000000;">not</span><span style="color: #000000;"> e.fini</span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> </span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;form method="post" action="'</span><span style="color: #ff00ff;">+</span><span style="color: #000000;">cefichier</span><span style="color: #ff00ff;">+</span><span style="color: #dd0000;">'" name="entree"&gt;&lt;input  name="probleme" class="probleme" &gt;&lt;/form&gt;'</span>

<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;p&gt;&lt;br&gt;&lt;br&gt;"</span>

<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;br&gt;&lt;br&gt;&lt;h2&gt;&lt;u&gt;Cas spéciaux :&lt;/u&gt;&lt;/h2&gt;"</span>

<span style="font-weight: bold;color: #000000;">for</span><span style="color: #000000;"> cas </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> e.rogers.answers.keys</span><span style="color: #ff00ff;">():</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> cas </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> e.rogers.keywords.keys</span><span style="color: #ff00ff;">():</span>
<span style="color: #000000;">		</span><span style="font-weight: bold;color: #000000;">continue</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;form method="post" action="'</span><span style="color: #ff00ff;">+</span><span style="color: #000000;">cefichier</span><span style="color: #ff00ff;">+</span><span style="color: #dd0000;">'" name="entree"&gt;'</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;input type="hidden" name="cas" value="'</span><span style="color: #ff00ff;">+</span><span style="color: #000000;">cas</span><span style="color: #ff00ff;">+</span><span style="color: #dd0000;">'"&gt;'</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;input type="hidden" name="probleme" value="'</span><span style="color: #ff00ff;">+</span><span style="color: #000000;">probleme</span><span style="color: #ff00ff;">+</span><span style="color: #dd0000;">'"&gt;'</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;">  </span><span style="color: #dd0000;">"&lt;table style='border:thin solid red; border-spacing:5px ;font-size: small; empty-cells:show; width:100%'&gt;"</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;tr&gt;: : : "</span><span style="color: #ff00ff;">+</span><span style="color: #000000;">cas</span><span style="color: #ff00ff;">+</span><span style="color: #dd0000;">"&lt;/tr&gt;"</span>
<span style="color: #000000;">	</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;tr&gt;&lt;td&gt;'</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"clés spéciaux"</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;/td&gt;&lt;td class='elizia'&gt;"</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;textarea name="answers" cols="80" rows="8" &gt;'</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">for</span><span style="color: #000000;"> rep </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> e.rogers.answers</span><span style="color: #ff00ff;">[</span><span style="color: #000000;">cas</span><span style="color: #ff00ff;">]:</span>
<span style="color: #000000;">		</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> rep</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;/textarea&gt;&lt;/td&gt;'</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;'</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;input type="submit" value=" Mettre à jour"; style="border:thin solid white; border-spacing:10px ;  width:100%"&gt;'</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/form&gt;"</span>

<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;br&gt;&lt;br&gt;&lt;h2&gt;&lt;u&gt;Cas normaux :&lt;/u&gt;&lt;/h2&gt;"</span>

<span style="font-weight: bold;color: #000000;">for</span><span style="color: #000000;"> cas </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> e.rogers.keywords.keys</span><span style="color: #ff00ff;">():</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;form method="post" action="'</span><span style="color: #ff00ff;">+</span><span style="color: #000000;">cefichier</span><span style="color: #ff00ff;">+</span><span style="color: #dd0000;">'" name="entree"&gt;'</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;input type="hidden" name="cas" value="'</span><span style="color: #ff00ff;">+</span><span style="color: #000000;">cas</span><span style="color: #ff00ff;">+</span><span style="color: #dd0000;">'"&gt;'</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;input type="hidden" name="probleme" value="'</span><span style="color: #ff00ff;">+</span><span style="color: #000000;">probleme</span><span style="color: #ff00ff;">+</span><span style="color: #dd0000;">'"&gt;'</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;">  </span><span style="color: #dd0000;">"&lt;table style='border:thin solid red; border-spacing:5px ;font-size: small; empty-cells:show; width:100%'&gt;"</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;tr&gt;: : : "</span><span style="color: #ff00ff;">+</span><span style="color: #000000;">cas</span><span style="color: #ff00ff;">+</span><span style="color: #dd0000;">"&lt;/tr&gt;"</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;tr&gt;&lt;td style="width:30%;" &gt;'</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;textarea name="keys" cols="30" rows="8" style=" font-size: x-small; height:100%; width:100%;"&gt;'</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">for</span><span style="color: #000000;"> key </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> e.rogers.keywords</span><span style="color: #ff00ff;">[</span><span style="color: #000000;">cas</span><span style="color: #ff00ff;">]:</span>
<span style="color: #000000;">		</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> key</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;/textarea&gt;'</span>
<span style="color: #000000;">	</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;/td&gt;&lt;td width='70%' style='width:70%;' class='elizia'&gt;"</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;textarea name="answers" style="width:100%;"   rows="8" &gt;'</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">for</span><span style="color: #000000;"> rep </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> e.rogers.answers</span><span style="color: #ff00ff;">[</span><span style="color: #000000;">cas</span><span style="color: #ff00ff;">]:</span>
<span style="color: #000000;">		</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> rep</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;/textarea&gt;&lt;/td&gt;'</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;'</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;input type="submit" value=" Mettre à jour"; style="border:thin solid white; border-spacing:10px ;  width:100%"&gt;'</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;"</span>
<span style="color: #000000;">	</span><span style="font-style: italic;color: #808080;">#print "&lt;p style='font-size: xx-small;'&gt;"+outputForRogers(cas)+"&lt;/p&gt;"</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;/form&gt;"</span>


<span style="color: #000000;">	</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;br&gt;&lt;br&gt;&lt;h2&gt;&lt;u&gt;Nouveau cas :&lt;/u&gt;&lt;/h2&gt;"</span>


<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;form method="post" action="'</span><span style="color: #ff00ff;">+</span><span style="color: #000000;">cefichier</span><span style="color: #ff00ff;">+</span><span style="color: #dd0000;">'" name="entree"&gt;'</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'Nom du nouveau cas :&lt;input name="cas"  &gt;'</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;input type="hidden" name="probleme" value="'</span><span style="color: #ff00ff;">+</span><span style="color: #000000;">probleme</span><span style="color: #ff00ff;">+</span><span style="color: #dd0000;">'"&gt;'</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;">  </span><span style="color: #dd0000;">"&lt;table style='border:thin solid red; border-spacing:5px ;font-size: small; empty-cells:show; width:100%'&gt;"</span>


<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;tr&gt;&lt;td width="30%"&gt;&lt;textarea name="keys" cols="30" rows="8" style=" font-size: x-small; height:100%; width:100%;"&gt;'</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"les mots clés (effacer cette ligne)"</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;/textarea&gt;'</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;/td&gt;&lt;td width='70%' class='elizia'&gt;"</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;textarea name="answers" cols="90"   rows="8" &gt;'</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"au moins deux réponses (effacer cette ligne)"</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;/textarea&gt;&lt;/td&gt;'</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;'</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;input type="submit" value=" Mettre à jour"; style="border:thin solid white; border-spacing:10px ;  width:100%"&gt;'</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/form&gt;"</span>


<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;br&gt;&lt;br&gt;"</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;div class="tech"&gt;'</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;p&gt;&lt;b&gt;&lt;u&gt;trucs techniques :&lt;/u&gt;&lt;/b&gt;&lt;/p&gt;"</span>
<span style="color: #000000;">memoire </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> sess.data.get</span><span style="color: #ff00ff;">(</span><span style="color: #dd0000;">'memoireinputsPatient'</span><span style="color: #ff00ff;">)</span>

<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;p&gt;&lt;b&gt;Cas : &lt;/b&gt;"</span><span style="color: #ff00ff;">+</span><span style="color: #000000;">e.cas</span><span style="color: #ff00ff;">+</span><span style="color: #dd0000;">"&lt;/p&gt;"</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;p&gt;&lt;b&gt;Conversation : &lt;/b&gt;&lt;/p&gt;"</span><span style="color: #000000;">	</span>
<span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"memoireReponses"</span><span style="color: #000000;"> </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> sess.data.keys</span><span style="color: #ff00ff;">():</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">for</span><span style="color: #000000;"> i </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> </span><span style="color: #800000;">range</span><span style="color: #ff00ff;">(</span><span style="color: #800000;">len</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">sess.data</span><span style="color: #ff00ff;">[</span><span style="color: #dd0000;">"memoireReponses"</span><span style="color: #ff00ff;">])):</span>
<span style="color: #000000;">		</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;">  </span><span style="color: #dd0000;">"&lt;p&gt;"</span><span style="color: #ff00ff;">+</span><span style="color: #000000;">time.asctime</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">time.localtime</span><span style="color: #ff00ff;">(</span><span style="color: #800000;">float</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">sess.data</span><span style="color: #ff00ff;">[</span><span style="color: #dd0000;">"memoireTemps"</span><span style="color: #ff00ff;">][</span><span style="color: #000000;">i</span><span style="color: #ff00ff;">])))</span><span style="color: #000000;">,</span>
<span style="color: #000000;">		</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">" : "</span><span style="color: #ff00ff;">+</span><span style="color: #000000;">sess.data</span><span style="color: #ff00ff;">[</span><span style="color: #dd0000;">"memoireinputsPatient"</span><span style="color: #ff00ff;">][</span><span style="color: #000000;">i</span><span style="color: #ff00ff;">]+</span><span style="color: #dd0000;">" - "</span><span style="color: #000000;">,</span>
<span style="color: #000000;">		</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> sess.data</span><span style="color: #ff00ff;">[</span><span style="color: #dd0000;">"memoireReponses"</span><span style="color: #ff00ff;">][</span><span style="color: #000000;">i</span><span style="color: #ff00ff;">]</span><span style="color: #000000;">,</span>
<span style="color: #000000;">		</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"("</span><span style="color: #ff00ff;">+</span><span style="color: #000000;">sess.data</span><span style="color: #ff00ff;">[</span><span style="color: #dd0000;">"memoireCas"</span><span style="color: #ff00ff;">][</span><span style="color: #000000;">i</span><span style="color: #ff00ff;">]+</span><span style="color: #dd0000;">")&lt;/p&gt;"</span>
<span style="color: #000000;">		</span>

<span style="color: #000000;">firstvisit </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> sess.data.get</span><span style="color: #ff00ff;">(</span><span style="color: #dd0000;">'firstvisit'</span><span style="color: #ff00ff;">)</span>
<span style="color: #000000;">lastvisit </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> sess.data.get</span><span style="color: #ff00ff;">(</span><span style="color: #dd0000;">'lastvisit'</span><span style="color: #ff00ff;">)</span>
<span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> firstvisit </span><span style="font-weight: bold;color: #000000;">and</span><span style="color: #000000;"> lastvisit </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> </span>
<span style="color: #000000;">	therapyduration </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">float</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">lastvisit</span><span style="color: #ff00ff;">)-</span><span style="color: #800000;">float</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">firstvisit</span><span style="color: #ff00ff;">)</span>
<span style="color: #000000;">	message </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;p&gt;Welcome back. Your last visit was on '</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">+</span><span style="color: #000000;"> 	time.asctime</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">time.localtime</span><span style="color: #ff00ff;">(</span><span style="color: #800000;">float</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">lastvisit</span><span style="color: #ff00ff;">)))</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">+</span><span style="color: #dd0000;">"&lt;/p&gt;"</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;p&gt;Your first visit was on "</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">+</span><span style="color: #000000;"> time.asctime</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">time.localtime</span><span style="color: #ff00ff;">(</span><span style="color: #800000;">float</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">firstvisit</span><span style="color: #ff00ff;">)))</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">+</span><span style="color: #dd0000;">"&lt;/p&gt;"</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;p&gt;"</span><span style="color: #000000;">, connaissance</span><span style="color: #ff00ff;">(</span><span style="color: #800000;">int</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">therapyduration</span><span style="color: #ff00ff;">))</span><span style="color: #000000;">,</span><span style="color: #dd0000;">"&lt;/p&gt;"</span>
<span style="font-weight: bold;color: #000000;">else</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> </span>
<span style="color: #000000;">	therapyduration </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">float</span><span style="color: #ff00ff;">(</span><span style="color: #0000ff;">0</span><span style="color: #ff00ff;">)</span>
<span style="color: #000000;">	message </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;p&gt;New session&lt;/p&gt;'</span>
<span style="color: #000000;">	sess.data</span><span style="color: #ff00ff;">[</span><span style="color: #dd0000;">'firstvisit'</span><span style="color: #ff00ff;">]</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">repr</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">time.time</span><span style="color: #ff00ff;">())</span>
<span style="color: #000000;">	firstvisit </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">repr</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">time.time</span><span style="color: #ff00ff;">())</span>
<span style="color: #000000;">	lastvisit </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">repr</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">time.time</span><span style="color: #ff00ff;">())</span>

<span style="font-style: italic;color: #808080;"># Save the current time in the session</span>
<span style="color: #000000;">sess.data</span><span style="color: #ff00ff;">[</span><span style="color: #dd0000;">'lastvisit'</span><span style="color: #ff00ff;">]</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">repr</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">time.time</span><span style="color: #ff00ff;">())</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> message</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> DBmessage</span><span style="color: #ff00ff;">+</span><span style="color: #dd0000;">"&lt;br&gt;"</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;p&gt;sess.cookie : "</span><span style="color: #ff00ff;">+</span><span style="color: #800000;">str</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">sess.cookie</span><span style="color: #ff00ff;">)+</span><span style="color: #dd0000;">"&lt;/p&gt;"</span>
<span style="font-weight: bold;color: #000000;">for</span><span style="color: #000000;"> i </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> sess.data.keys</span><span style="color: #ff00ff;">():</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> i</span><span style="color: #ff00ff;">==</span><span style="color: #dd0000;">"memoireReponses"</span><span style="color: #000000;"> </span><span style="font-weight: bold;color: #000000;">or</span><span style="color: #000000;"> i</span><span style="color: #ff00ff;">==</span><span style="color: #dd0000;">"memoireinputsPatient"</span><span style="color: #000000;"> </span><span style="font-weight: bold;color: #000000;">or</span><span style="color: #000000;"> i</span><span style="color: #ff00ff;">==</span><span style="color: #dd0000;">"memoireTemps"</span><span style="color: #000000;"> </span><span style="font-weight: bold;color: #000000;">or</span><span style="color: #000000;"> i</span><span style="color: #ff00ff;">==</span><span style="color: #dd0000;">"memoireCas"</span><span style="color: #ff00ff;">:</span>
<span style="color: #000000;">		</span><span style="font-weight: bold;color: #000000;">pass</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">else</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> </span><span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;">  </span><span style="color: #dd0000;">"&lt;p&gt;&lt;b&gt;"</span><span style="color: #ff00ff;">+</span><span style="color: #000000;">i</span><span style="color: #ff00ff;">+</span><span style="color: #dd0000;">": &lt;/b&gt;"</span><span style="color: #ff00ff;">+</span><span style="color: #800000;">str</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">sess.data</span><span style="color: #ff00ff;">[</span><span style="color: #000000;">i</span><span style="color: #ff00ff;">])+</span><span style="color: #dd0000;">"&lt;/p&gt;"</span>

<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;p&gt;&lt;b&gt;Referer:&lt;/b&gt;"</span><span style="color: #000000;">, os.environ.get</span><span style="color: #ff00ff;">(</span><span style="color: #dd0000;">"HTTP_REFERER"</span><span style="color: #000000;">, </span><span style="color: #dd0000;">"&lt;not present&gt;"</span><span style="color: #ff00ff;">)</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;p&gt;&lt;b&gt;User Agent:&lt;/b&gt;"</span><span style="color: #000000;">, os.environ.get</span><span style="color: #ff00ff;">(</span><span style="color: #dd0000;">"HTTP_USER_AGENT"</span><span style="color: #000000;">, </span><span style="color: #dd0000;">"&lt;unknown&gt;"</span><span style="color: #ff00ff;">)</span>
<span style="color: #000000;">ipnum </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> os.environ.get</span><span style="color: #ff00ff;">(</span><span style="color: #dd0000;">"REMOTE_ADDR"</span><span style="color: #000000;">, </span><span style="color: #dd0000;">"&lt;not present&gt;"</span><span style="color: #ff00ff;">)</span>
<span style="color: #000000;">sess.data</span><span style="color: #ff00ff;">[</span><span style="color: #dd0000;">'ipnum'</span><span style="color: #ff00ff;">]</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> ipnum</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;p&gt;&lt;b&gt;IP:&lt;/b&gt;"</span><span style="color: #000000;">, ipnum</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">'&lt;/div&gt;'</span>
<span style="color: #000000;">sess.close</span><span style="color: #ff00ff;">()</span>
<span style="font-weight: bold;color: #000000;">print</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"&lt;/body&gt;&lt;/html&gt;"</span>


<span style="color: #000000;">	</span>
</pre></body>
</html>
