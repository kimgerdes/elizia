<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="Generator" content="Kate, the KDE Advanced Text Editor" />
<title>analyste.py</title>
</head>
<body>
<pre>
<span style="font-style: italic;color: #808080;">#!/usr/bin/python</span>
<span style="font-style: italic;color: #808080;"># -*- coding: iso-8859-1 -*-</span>

<span style="font-style: italic;color: #808080;">####</span>
<span style="font-style: italic;color: #808080;"># Copyright (C) 2006, 2007 Kim Gerdes</span>
<span style="font-style: italic;color: #808080;"># kim AT gerdes.fr</span>
<span style="font-style: italic;color: #808080;">#</span>
<span style="font-style: italic;color: #808080;"># This program is free software; you can redistribute it and/or</span>
<span style="color: #000000;"> </span><span style="font-style: italic;color: #808080;"># modify it under the terms of the GNU General Public License</span>
<span style="color: #000000;"> </span><span style="font-style: italic;color: #808080;"># as published by the Free Software Foundation; either version 2</span>
<span style="color: #000000;"> </span><span style="font-style: italic;color: #808080;"># of the License, or (at your option) any later version.</span>
<span style="font-style: italic;color: #808080;">#</span>
<span style="font-style: italic;color: #808080;"># This script is distributed in the hope that it will be useful,</span>
<span style="font-style: italic;color: #808080;"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span style="font-style: italic;color: #808080;"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE</span>
<span style="font-style: italic;color: #808080;"># See the GNU General Public License (www.gnu.org) for more details.</span>
<span style="font-style: italic;color: #808080;">#</span>
<span style="font-style: italic;color: #808080;"># You can retrieve a copy of the GNU General Public License</span>
<span style="font-style: italic;color: #808080;"># from http://www.gnu.org/.  For a copy via US Mail, write to the</span>
<span style="font-style: italic;color: #808080;">#     Free Software Foundation, Inc.</span>
<span style="font-style: italic;color: #808080;">#     59 Temple Place - Suite 330,</span>
<span style="font-style: italic;color: #808080;">#     Boston, MA  02111-1307</span>
<span style="font-style: italic;color: #808080;">#     USA</span>
<span style="font-style: italic;color: #808080;">####</span>

<span style="color: #ff00ff;">import</span><span style="color: #000000;"> time, re, cgitb, cgi,sha, Cookie, os,sys</span>
<span style="color: #000000;">cgitb.enable</span><span style="color: #ff00ff;">()</span>
<span style="color: #ff00ff;">import</span><span style="color: #000000;"> session</span>
<span style="color: #ff00ff;">from</span><span style="color: #000000;"> random </span><span style="color: #ff00ff;">import</span><span style="color: #000000;"> choice</span>
<span style="color: #ff00ff;">from</span><span style="color: #000000;"> frenchLinguist </span><span style="color: #ff00ff;">import</span><span style="color: #000000;"> FrenchLinguist</span>
<span style="color: #ff00ff;">from</span><span style="color: #000000;"> rogers </span><span style="color: #ff00ff;">import</span><span style="color: #000000;"> Rogers</span>


<span style="font-weight: bold;color: #000000;">class</span><span style="color: #000000;"> Elizia</span><span style="color: #ff00ff;">:</span>
<span style="color: #000000;">	</span>

<span style="color: #000000;">    rogers </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> Rogers</span><span style="color: #ff00ff;">()</span>
<span style="color: #000000;">    linguist </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> FrenchLinguist</span><span style="color: #ff00ff;">()</span>
<span style="color: #000000;">    listeInterro</span><span style="color: #ff00ff;">=[</span><span style="color: #dd0000;">"pourquoi"</span><span style="color: #000000;">,</span><span style="color: #dd0000;">"quand"</span><span style="color: #000000;">,</span><span style="color: #dd0000;">"comment"</span><span style="color: #ff00ff;">]</span>
<span style="color: #000000;">    </span>
<span style="color: #000000;">    fini </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #008000;">False</span>
<span style="color: #000000;">    dicoDejaDitElizia </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">{}</span>

<span style="color: #000000;">    cas </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"Retour"</span><span style="color: #000000;"> </span><span style="font-style: italic;color: #808080;"># contient le mot clé trouvé   </span>
<span style="color: #000000;">    patientInput </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"???"</span><span style="color: #000000;"> </span><span style="font-style: italic;color: #808080;"># devrait être écrasé par le vrai input</span>
<span style="color: #000000;">    </span>
<span style="color: #000000;">     </span>
<span style="color: #000000;">   </span>
<span style="color: #000000;">    </span><span style="font-weight: bold;color: #000000;">def</span><span style="color: #000000;"> analyse</span><span style="color: #ff00ff;">(</span><span style="color: #008000;">self</span><span style="color: #000000;">, texte, sess</span><span style="color: #ff00ff;">):</span>
<span style="color: #000000;">	</span><span style="font-style: italic;color: #808080;">""" ici se fait tout le boulot. """</span>
<span style="color: #000000;">	</span><span style="color: #008000;">self</span><span style="color: #000000;">.sess </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> sess</span>
<span style="color: #000000;">	avantPatient </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> sess.data.get</span><span style="color: #ff00ff;">(</span><span style="color: #dd0000;">'memoireinputsPatient'</span><span style="color: #ff00ff;">)</span>
<span style="color: #000000;">	</span><span style="color: #008000;">self</span><span style="color: #000000;">.avantCas </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> sess.data.get</span><span style="color: #ff00ff;">(</span><span style="color: #dd0000;">'memoireCas'</span><span style="color: #ff00ff;">)</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> </span><span style="font-weight: bold;color: #000000;">not</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.avantCas</span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.avantCas</span><span style="color: #ff00ff;">=[]</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> avantPatient </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> memoireinputsPatient </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> avantPatient </span><span style="color: #ff00ff;">+</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">[</span><span style="color: #000000;">texte</span><span style="color: #ff00ff;">]</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">else</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> </span>
<span style="color: #000000;">		memoireinputsPatient </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">[</span><span style="color: #000000;">texte</span><span style="color: #ff00ff;">]</span>
<span style="color: #000000;">		avantPatient </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">[]</span>
<span style="color: #000000;">	sess.data</span><span style="color: #ff00ff;">[</span><span style="color: #dd0000;">'memoireinputsPatient'</span><span style="color: #ff00ff;">]</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> memoireinputsPatient</span>
<span style="color: #000000;">	</span>
<span style="color: #000000;">	avantelizia </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> sess.data.get</span><span style="color: #ff00ff;">(</span><span style="color: #dd0000;">'dejaDitelizia'</span><span style="color: #ff00ff;">)</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> avantelizia </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.dicoDejaDitElizia </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> avantelizia	</span>
<span style="color: #000000;">	</span>
<span style="color: #000000;">	</span><span style="color: #008000;">self</span><span style="color: #000000;">.patientInput </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> texte.strip</span><span style="color: #ff00ff;">()</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> </span><span style="color: #800000;">len</span><span style="color: #ff00ff;">(</span><span style="color: #008000;">self</span><span style="color: #000000;">.patientInput</span><span style="color: #ff00ff;">)&gt;</span><span style="color: #0000ff;">1</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.patientInput </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.patientInput</span><span style="color: #ff00ff;">[</span><span style="color: #0000ff;">0</span><span style="color: #ff00ff;">]</span><span style="color: #000000;">.lower</span><span style="color: #ff00ff;">()+</span><span style="color: #008000;">self</span><span style="color: #000000;">.patientInput</span><span style="color: #ff00ff;">[</span><span style="color: #0000ff;">1</span><span style="color: #ff00ff;">:]</span>
<span style="color: #000000;">	</span><span style="color: #008000;">self</span><span style="color: #000000;">.patientInput </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.linguist.decontracte</span><span style="color: #ff00ff;">(</span><span style="color: #008000;">self</span><span style="color: #000000;">.patientInput</span><span style="color: #ff00ff;">)</span>


<span style="color: #000000;">	</span>
<span style="color: #000000;">	inputPropre </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.linguist.nettoyerTexte</span><span style="color: #ff00ff;">(</span><span style="color: #008000;">self</span><span style="color: #000000;">.patientInput</span><span style="color: #ff00ff;">)</span>
<span style="color: #000000;">	inputSplit </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> inputPropre.split</span><span style="color: #ff00ff;">()</span>

<span style="color: #000000;">	</span><span style="font-style: italic;color: #808080;">#voir si le patient a dit qqch</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> </span><span style="color: #800000;">len</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">inputSplit</span><span style="color: #ff00ff;">)==</span><span style="color: #0000ff;">0</span><span style="color: #ff00ff;">:</span>
<span style="color: #000000;">		</span><span style="color: #008000;">self</span><span style="color: #000000;">.cas </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"Vide"</span>
<span style="color: #000000;">		</span><span style="font-weight: bold;color: #000000;">return</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.repo</span><span style="color: #ff00ff;">()</span>
<span style="color: #000000;">	</span>
<span style="color: #000000;">	</span><span style="font-style: italic;color: #808080;"># voir si le patient a pê posé une question :</span>
<span style="color: #000000;">	</span><span style="font-style: italic;color: #808080;"># donc si ça commence avec un mot interrogatif ou termine sur un point d'interrogation</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> inputSplit</span><span style="color: #ff00ff;">[</span><span style="color: #0000ff;">0</span><span style="color: #ff00ff;">]</span><span style="color: #000000;"> </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.listeInterro </span><span style="font-weight: bold;color: #000000;">or</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.patientInput</span><span style="color: #ff00ff;">[-</span><span style="color: #0000ff;">1</span><span style="color: #ff00ff;">]==</span><span style="color: #dd0000;">"?"</span><span style="color: #ff00ff;">:</span>
<span style="color: #000000;">		</span><span style="color: #008000;">self</span><span style="color: #000000;">.cas </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"Question"</span>
<span style="color: #000000;">		</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">elif</span><span style="color: #000000;"> texte </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> avantPatient </span><span style="color: #ff00ff;">:</span>
<span style="color: #000000;">		</span><span style="color: #008000;">self</span><span style="color: #000000;">.cas </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"Déjà"</span>
<span style="color: #000000;">	</span><span style="font-style: italic;color: #808080;">#voir si le patient est très bref</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">elif</span><span style="color: #000000;"> </span><span style="color: #800000;">len</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">inputSplit</span><span style="color: #ff00ff;">)==</span><span style="color: #0000ff;">1</span><span style="color: #ff00ff;">:</span>
<span style="color: #000000;">		</span><span style="color: #008000;">self</span><span style="color: #000000;">.cas </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"Bref"</span>
<span style="color: #000000;">			</span>
<span style="color: #000000;">	</span><span style="font-style: italic;color: #808080;"># mots clés</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">for</span><span style="color: #000000;"> nom </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.rogers.keywords.keys</span><span style="color: #ff00ff;">():</span><span style="color: #000000;"> </span><span style="font-style: italic;color: #808080;"># pour chaque clé		</span>
<span style="color: #000000;">		</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.cleTrouvee</span><span style="color: #ff00ff;">(</span><span style="color: #008000;">self</span><span style="color: #000000;">.rogers.keywords</span><span style="color: #ff00ff;">[</span><span style="color: #000000;">nom</span><span style="color: #ff00ff;">]</span><span style="color: #000000;">,inputPropre,inputSplit</span><span style="color: #ff00ff;">):</span>
<span style="color: #000000;">			</span><span style="color: #008000;">self</span><span style="color: #000000;">.cas </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> nom</span>
<span style="color: #000000;">			</span>
<span style="color: #000000;">	</span>
<span style="color: #000000;">				</span>

<span style="color: #000000;">	</span><span style="font-style: italic;color: #808080;"># s'il n'a rien trouvé alors retourne la input</span>
<span style="color: #000000;">	</span><span style="font-style: italic;color: #808080;"># (cas self.cas = "Retour")</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">return</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.repo</span><span style="color: #ff00ff;">()</span>



<span style="color: #000000;">    </span><span style="font-weight: bold;color: #000000;">def</span><span style="color: #000000;"> cleTrouvee</span><span style="color: #ff00ff;">(</span><span style="color: #008000;">self</span><span style="color: #000000;">,cles,texte,liste</span><span style="color: #ff00ff;">):</span>
<span style="color: #000000;">        </span><span style="font-style: italic;color: #808080;">""" </span>
<span style="font-style: italic;color: #808080;">	cherche une liste cles dans un texte (string) et dans la liste de mots correspondante</span>
<span style="font-style: italic;color: #808080;">	deux cas : clé est un mot : il doit apparaître entouré de blancs </span>
<span style="font-style: italic;color: #808080;">	ou clé contient des espaces : peu importe, tant qu'il apparaît</span>
<span style="font-style: italic;color: #808080;">	"""</span>
<span style="color: #000000;">	</span>
<span style="color: #000000;">	</span>
<span style="color: #000000;">        </span><span style="font-weight: bold;color: #000000;">for</span><span style="color: #000000;"> c </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> cles </span><span style="color: #ff00ff;">:</span>
<span style="color: #000000;">		</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> </span><span style="color: #dd0000;">" "</span><span style="color: #000000;"> </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> c </span><span style="font-weight: bold;color: #000000;">and</span><span style="color: #000000;"> c </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> texte</span><span style="color: #ff00ff;">:</span>
<span style="color: #000000;">			</span><span style="font-weight: bold;color: #000000;">return</span><span style="color: #000000;"> </span><span style="color: #008000;">True</span>
<span style="color: #000000;">		</span><span style="font-weight: bold;color: #000000;">elif</span><span style="color: #000000;"> c </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> liste </span><span style="color: #ff00ff;">:</span>
<span style="color: #000000;">			</span><span style="font-weight: bold;color: #000000;">return</span><span style="color: #000000;"> </span><span style="color: #008000;">True</span>
<span style="color: #000000;">        </span><span style="font-weight: bold;color: #000000;">return</span><span style="color: #000000;"> </span><span style="color: #008000;">False</span>

<span style="color: #000000;">  </span>
<span style="color: #000000;">   </span>
<span style="color: #000000;">    </span><span style="font-weight: bold;color: #000000;">def</span><span style="color: #000000;"> repo</span><span style="color: #ff00ff;">(</span><span style="color: #008000;">self</span><span style="color: #ff00ff;">):</span>
<span style="color: #000000;">	</span><span style="font-style: italic;color: #808080;">""" fonction importante qui rend la réponse et gêre les mémoires """</span>
<span style="color: #000000;">	</span>
<span style="color: #000000;">	ordered </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #008000;">False</span>
<span style="color: #000000;">	reponse </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #dd0000;">""</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.cas </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.dicoDejaDitElizia.keys</span><span style="color: #ff00ff;">()</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> memoire </span><span style="color: #ff00ff;">=</span><span style="color: #000000;">  </span><span style="color: #008000;">self</span><span style="color: #000000;">.dicoDejaDitElizia</span><span style="color: #ff00ff;">[</span><span style="color: #008000;">self</span><span style="color: #000000;">.cas</span><span style="color: #ff00ff;">]</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">else</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> memoire </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">[]</span><span style="color: #000000;">	</span>
<span style="color: #000000;">	</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.cas </span><span style="color: #ff00ff;">==</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"Insulte"</span><span style="color: #ff00ff;">:</span>
<span style="color: #000000;">		ordered </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #008000;">True</span>
<span style="color: #000000;">		</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> </span><span style="color: #800000;">len</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">memoire</span><span style="color: #ff00ff;">)</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">&gt;=</span><span style="color: #000000;"> </span><span style="color: #800000;">len</span><span style="color: #ff00ff;">(</span><span style="color: #008000;">self</span><span style="color: #000000;">.rogers.answers</span><span style="color: #ff00ff;">[</span><span style="color: #008000;">self</span><span style="color: #000000;">.cas</span><span style="color: #ff00ff;">])-</span><span style="color: #0000ff;">2</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> </span>
<span style="color: #000000;">			</span><span style="color: #008000;">self</span><span style="color: #000000;">.fini </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #008000;">True</span>
<span style="color: #000000;">			</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.cas </span><span style="color: #ff00ff;">==</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"Fin"</span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> </span>
<span style="color: #000000;">		</span><span style="color: #008000;">self</span><span style="color: #000000;">.fini </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #008000;">True</span><span style="color: #000000;">	</span>
<span style="color: #000000;">			</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.cas </span><span style="color: #ff00ff;">==</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"Retour"</span><span style="color: #000000;"> </span><span style="font-weight: bold;color: #000000;">or</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.cas </span><span style="color: #ff00ff;">==</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"Bref"</span><span style="color: #ff00ff;">:</span>
<span style="color: #000000;">		ll </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">len</span><span style="color: #ff00ff;">(</span><span style="color: #008000;">self</span><span style="color: #000000;">.avantCas</span><span style="color: #ff00ff;">)</span>
<span style="color: #000000;">		</span><span style="font-weight: bold;color: #000000;">for</span><span style="color: #000000;"> i </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> </span><span style="color: #800000;">range</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">ll</span><span style="color: #ff00ff;">)</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span>
<span style="color: #000000;">			</span><span style="font-style: italic;color: #808080;">#print self.avantCas[ll-i-1]</span>
<span style="color: #000000;">			</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.avantCas</span><span style="color: #ff00ff;">[</span><span style="color: #000000;">ll</span><span style="color: #ff00ff;">-</span><span style="color: #000000;">i</span><span style="color: #ff00ff;">-</span><span style="color: #0000ff;">1</span><span style="color: #ff00ff;">]</span><span style="color: #000000;"> </span><span style="font-weight: bold;color: #000000;">not</span><span style="color: #000000;"> </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.rogers.noRecall </span><span style="color: #ff00ff;">:</span>
<span style="color: #000000;">				</span><span style="color: #008000;">self</span><span style="color: #000000;">.cas </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"Reprise"</span>
<span style="color: #000000;">				casRepris </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.avantCas</span><span style="color: #ff00ff;">[</span><span style="color: #000000;">ll</span><span style="color: #ff00ff;">-</span><span style="color: #000000;">i</span><span style="color: #ff00ff;">-</span><span style="color: #0000ff;">1</span><span style="color: #ff00ff;">]</span>
<span style="color: #000000;">				</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> casRepris </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.dicoDejaDitElizia.keys</span><span style="color: #ff00ff;">()</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> memoReprise </span><span style="color: #ff00ff;">=</span><span style="color: #000000;">  </span><span style="color: #008000;">self</span><span style="color: #000000;">.dicoDejaDitElizia</span><span style="color: #ff00ff;">[</span><span style="color: #000000;">casRepris</span><span style="color: #ff00ff;">]</span>
<span style="color: #000000;">				</span><span style="font-weight: bold;color: #000000;">else</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> memoReprise </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">[]</span>
<span style="color: #000000;">				reponse </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #dd0000;">" &amp;nbsp;"</span><span style="color: #ff00ff;">+</span><span style="color: #008000;">self</span><span style="color: #000000;">.choisirReponse</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">casRepris,memoReprise,</span><span style="color: #008000;">False</span><span style="color: #ff00ff;">)</span>
<span style="color: #000000;">				</span>
<span style="color: #000000;">				</span><span style="font-weight: bold;color: #000000;">break</span>
<span style="color: #000000;">				</span>
<span style="color: #000000;">				</span>
<span style="color: #000000;">				</span>


<span style="color: #000000;">	</span>
<span style="color: #000000;">	</span>
<span style="color: #000000;">	reponse </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.choisirReponse</span><span style="color: #ff00ff;">(</span><span style="color: #008000;">self</span><span style="color: #000000;">.cas,memoire,ordered</span><span style="color: #ff00ff;">)</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">+</span><span style="color: #000000;"> reponse</span>
<span style="color: #000000;">	</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.cas </span><span style="color: #ff00ff;">==</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"Reprise"</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> reponse </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> reponse.replace</span><span style="color: #ff00ff;">(</span><span style="color: #dd0000;">"xxx"</span><span style="color: #000000;">,casRepris</span><span style="color: #ff00ff;">)</span>
<span style="color: #000000;">	</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.cas </span><span style="color: #ff00ff;">==</span><span style="color: #000000;"> </span><span style="color: #dd0000;">"Retour"</span><span style="color: #ff00ff;">:</span>
<span style="color: #000000;">		reponse </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> reponse </span><span style="color: #ff00ff;">+</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.linguist.phraseEnchassee</span><span style="color: #ff00ff;">(</span><span style="color: #008000;">self</span><span style="color: #000000;">.patientInput</span><span style="color: #ff00ff;">)</span>

<span style="color: #000000;">        </span><span style="font-style: italic;color: #808080;">#memoireReponses=memoire+[reponse] # se souvenir de ce qu'on a dit</span>
<span style="color: #000000;">	before </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.sess.data.get</span><span style="color: #ff00ff;">(</span><span style="color: #dd0000;">'memoireReponses'</span><span style="color: #ff00ff;">)</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> before </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> memoireReponses </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> before </span><span style="color: #ff00ff;">+</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">[</span><span style="color: #000000;">reponse</span><span style="color: #ff00ff;">]</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">else</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> memoireReponses </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">[</span><span style="color: #000000;">reponse</span><span style="color: #ff00ff;">]</span>
<span style="color: #000000;">	</span><span style="color: #008000;">self</span><span style="color: #000000;">.sess.data</span><span style="color: #ff00ff;">[</span><span style="color: #dd0000;">'memoireReponses'</span><span style="color: #ff00ff;">]</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> memoireReponses</span>
<span style="color: #000000;">	</span>
<span style="color: #000000;">	beforeCas </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.sess.data.get</span><span style="color: #ff00ff;">(</span><span style="color: #dd0000;">'memoireCas'</span><span style="color: #ff00ff;">)</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> before </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> memoireCas </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> beforeCas </span><span style="color: #ff00ff;">+</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">[</span><span style="color: #008000;">self</span><span style="color: #000000;">.cas</span><span style="color: #ff00ff;">]</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">else</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> memoireCas </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">[</span><span style="color: #008000;">self</span><span style="color: #000000;">.cas</span><span style="color: #ff00ff;">]</span>
<span style="color: #000000;">	</span><span style="color: #008000;">self</span><span style="color: #000000;">.sess.data</span><span style="color: #ff00ff;">[</span><span style="color: #dd0000;">'memoireCas'</span><span style="color: #ff00ff;">]</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> memoireCas</span>
<span style="color: #000000;">	</span>
<span style="color: #000000;">	beforeTemps </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.sess.data.get</span><span style="color: #ff00ff;">(</span><span style="color: #dd0000;">'memoireTemps'</span><span style="color: #ff00ff;">)</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> beforeTemps </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> memoireTemps </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> beforeTemps </span><span style="color: #ff00ff;">+</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">[</span><span style="color: #800000;">repr</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">time.time</span><span style="color: #ff00ff;">())]</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">else</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> memoireTemps </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">[</span><span style="color: #800000;">repr</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">time.time</span><span style="color: #ff00ff;">())]</span>
<span style="color: #000000;">	</span><span style="color: #008000;">self</span><span style="color: #000000;">.sess.data</span><span style="color: #ff00ff;">[</span><span style="color: #dd0000;">'memoireTemps'</span><span style="color: #ff00ff;">]</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> memoireTemps</span>

<span style="color: #000000;">		</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">return</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.linguist.beautifier</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">reponse</span><span style="color: #ff00ff;">)</span>

<span style="color: #000000;">    </span><span style="font-weight: bold;color: #000000;">def</span><span style="color: #000000;"> choisirReponse</span><span style="color: #ff00ff;">(</span><span style="color: #008000;">self</span><span style="color: #000000;">,casActuel,memoireActuel,ordered</span><span style="color: #ff00ff;">):</span>
<span style="color: #000000;">	</span><span style="font-style: italic;color: #808080;"># le [:] permet de faire une copie</span>
<span style="color: #000000;">        </span><span style="font-style: italic;color: #808080;">#       - pour qu'on ne touche pas à la liste originale</span>
<span style="color: #000000;">        listeReponseLocale</span><span style="color: #ff00ff;">=</span><span style="color: #008000;">self</span><span style="color: #000000;">.rogers.answers</span><span style="color: #ff00ff;">[</span><span style="color: #000000;">casActuel</span><span style="color: #ff00ff;">][:]</span>

<span style="color: #000000;">	</span>
<span style="color: #000000;">        </span><span style="font-weight: bold;color: #000000;">for</span><span style="color: #000000;"> rep </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> memoireActuel</span><span style="color: #ff00ff;">:</span>
<span style="color: #000000;">		</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> rep </span><span style="font-weight: bold;color: #000000;">in</span><span style="color: #000000;"> listeReponseLocale</span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> </span><span style="font-style: italic;color: #808080;"># normalement, ça devrait tjrs être dedans</span>
<span style="color: #000000;">			listeReponseLocale.remove</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">rep</span><span style="color: #ff00ff;">)</span><span style="color: #000000;"> </span><span style="font-style: italic;color: #808080;"># on enlève ce qu'on a déjà dit</span>
<span style="color: #000000;">        </span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> ordered </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> 	reponse </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> listeReponseLocale</span><span style="color: #ff00ff;">[</span><span style="color: #0000ff;">0</span><span style="color: #ff00ff;">]</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">else</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">:</span><span style="color: #000000;"> 		reponse </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> choice</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">listeReponseLocale</span><span style="color: #ff00ff;">)</span><span style="color: #000000;"> </span><span style="font-style: italic;color: #808080;"># choix par hasard parmi le reste</span>
<span style="color: #000000;">	</span>
<span style="color: #000000;">	memoireCas</span><span style="color: #ff00ff;">=</span><span style="color: #000000;">memoireActuel</span><span style="color: #ff00ff;">+[</span><span style="color: #000000;">reponse</span><span style="color: #ff00ff;">]</span><span style="color: #000000;"> </span><span style="font-style: italic;color: #808080;"># on retient la réponse (sans phrase du patient en cas Retour)</span>
<span style="color: #000000;">	</span>
<span style="color: #000000;">	</span><span style="font-style: italic;color: #808080;"># vider le mémoire sauf la dernière réponse au cas où on a déjà	utilisé toutes les réponses proposées</span>
<span style="color: #000000;">	</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">if</span><span style="color: #000000;"> </span><span style="color: #800000;">len</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">memoireCas</span><span style="color: #ff00ff;">)</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">&gt;=</span><span style="color: #000000;"> </span><span style="color: #800000;">len</span><span style="color: #ff00ff;">(</span><span style="color: #008000;">self</span><span style="color: #000000;">.rogers.answers</span><span style="color: #ff00ff;">[</span><span style="color: #000000;">casActuel</span><span style="color: #ff00ff;">]):</span>
<span style="color: #000000;">            </span><span style="font-weight: bold;color: #000000;">while</span><span style="color: #000000;"> </span><span style="color: #800000;">len</span><span style="color: #ff00ff;">(</span><span style="color: #000000;">memoireCas</span><span style="color: #ff00ff;">)&gt;</span><span style="color: #0000ff;">1</span><span style="color: #ff00ff;">:</span>
<span style="color: #000000;">                memoireCas.pop</span><span style="color: #ff00ff;">(</span><span style="color: #0000ff;">0</span><span style="color: #ff00ff;">)</span>
<span style="color: #000000;">		</span>
<span style="color: #000000;">	</span><span style="color: #008000;">self</span><span style="color: #000000;">.dicoDejaDitElizia</span><span style="color: #ff00ff;">[</span><span style="color: #000000;">casActuel</span><span style="color: #ff00ff;">]=</span><span style="color: #000000;">memoireCas</span>
<span style="color: #000000;">	</span><span style="color: #008000;">self</span><span style="color: #000000;">.sess.data</span><span style="color: #ff00ff;">[</span><span style="color: #dd0000;">'dejaDitelizia'</span><span style="color: #ff00ff;">]</span><span style="color: #000000;"> </span><span style="color: #ff00ff;">=</span><span style="color: #000000;"> </span><span style="color: #008000;">self</span><span style="color: #000000;">.dicoDejaDitElizia</span>
<span style="color: #000000;">	</span>
<span style="color: #000000;">	</span><span style="font-weight: bold;color: #000000;">return</span><span style="color: #000000;"> reponse</span>
<span style="color: #000000;">	</span>
<span style="color: #000000;">	</span></pre></body>
</html>
